# 推荐系统实践学习笔记

> 本书讲了什么
>
> 介绍什么是推荐系统； 介绍几种做推荐的方式； 最后列举了几个推荐系统的实例。

## 好的推荐系统

### 什么是推荐系统

推荐系统让用户能够发现对自己有价值的信息，另一方面，能够让信息展现在对它感兴趣的用户面前。实现消费者和生产者的双赢。

### 几个理论

#### 长尾理论

来自市场营销上的说法。即传统认为，厂商80%的收入很可能来自20%热门商品。但在互联网条件下，由于铺货成本极其低廉，那些不热门的商品销售数量可能极其庞大，使得其销售收入与热门商品相当甚至更多。推荐系统就是基于长尾理论, 将长尾商品推荐给用户, 实现收益增加

#### 幂律分布

一种分布， 曲线如下。长尾理论就是幂律分布的通俗体现。常见幂律分布：英文单词、个人收入等

![img](https://gss0.bdstatic.com/94o3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D220/sign=8ab03b31e2fe9925cf0c6e5204a95ee4/cc11728b4710b9127865d50ac1fdfc0393452299.jpg)

#### 马太效应

即两极分化效应，强者越强， 弱者越弱

出自《新约·马太福音》： “凡有的，还要加倍给他叫他多余；没有的，连他所有的也要夺过来”

### 推荐系统原理

推荐系统并没有特别高深的理论，它只不过将我们平常的检索进行了自动化

- 社会化推荐：对应于向好友咨询
- 基于内容的推荐：对应于我们手动搜索电影片名或演员名
- 基于协同过滤的推荐：对应于查看排行榜，找到广受好评的电影

推荐的本质是将用户和物品联系起来。而不同的推荐系统只是利用了不同的联系方式

### 推荐做得好的应用

- 亚马逊
  - 让每个用户像是拥有自己的专属商店一样
  - 20-30%收入来自推荐系统
- Netflix
  - 举办了推荐系统比赛
  - 自己宣称有60%的用户是通过推荐系统找到自己喜欢的影片的
- Youtube
  - 其实验表明。个性化推荐的视频点击率是热门视频点击率的两倍

- 音乐电台
  - 豆瓣电台：用户无法自己选取歌曲。只能标记喜欢或不喜欢，模型建立完成后就能够推荐用户感兴趣的歌曲。
- facebook
  - 利用推荐系统推荐广告、推荐信息流、推荐好友
  - 退出了API，称为Instant Personalization，能够推荐用户的好友喜欢的物品。
- 阅读推荐
  - 今日头条等

### 什么是好的推荐系统

合格的满足如下三点

- 用户能够得到自己的感兴趣的推荐内容
- 商品提供方的物品要能够被推荐到合适的用户手中
- 能够收集到高质量的用户反馈， 从而不断完善推荐系统， 提高推荐准确性。

好的推荐系统还满足一点

- 不仅能够预测用户的行为， 还能扩展用户的视野，帮助其发现潜在的新东西

注意， 准确性并不能完全决定推荐算法的好坏。 比如预测太阳从东方升起，这是100%准确的预测， 但是也是一个毫无意义的预测。

### 如何测试推荐系统

- 离线测试：即使用现有的数据集对系统进行测试
- 用户调查：直接上线前的测试，先做用户调查，让用户为推荐系统进行评价
- 在线实验：用户调查完成后上线。评价的标准是做AB test，即和原有的算法进行比较。

上面三个处于推荐系统的不同开发阶段。先离线测试，OK后做用户调查，OK后上线实验

### 测试标准

- 用户满意度
- 预测准确度

- 覆盖率：即对长尾物品的发掘能力。如果所有物品都出现在推荐列表中， 并且出现次数差不多， 则长尾发掘能力就好很多

  两个指标定义覆盖率

  - 信息熵：https://www.cnblogs.com/IamJiangXiaoKun/p/9455689.html。简单说，信息熵就是对一个不确定事件发生所可能产生的信息量的期望。而信息量和该时间发生概率的对数的倒数有关。即一个事件发生概率越高，则产生的信息量越小；概率越低，产生的信息量越大。

  - 基尼系数：用于衡量收入分配是否均匀之类的问题。计算方法是A/B。当A为0时，基尼系数为0.说明绝对平等了。当A很大时，说明非常不平衡。

    ![img](https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=2c95402b392ac65c73086e219a9bd974/b812c8fcc3cec3fdea113b3eda88d43f87942749.jpg)

- 多样性：推荐多种多样的商品
- 新颖性：推荐用户没听说过的商品
- 惊喜度：相比新颖性，还能让用户感觉使用之后很惊喜
- 信任度：涉及推荐的方式，要让用户新人所推荐的内容，愿意购买商品
- 实时性：比如用户新买了一个iphone，及时给他推荐手机壳之类的
- 健壮性：抗击作弊

# 利用用户数据行为数据的推荐算法

## 为什么要根据用户行为

### 为什么不根据用户语言?

标题是利用用户的数据行为, 是根据用户的实际动作进行演算的方法, 那为什么不利用用户语言进行演算呢? 最大的原因就是用户也说不清楚自己到底喜欢什么, 而用户的实际行为往往能够暴露其真实想法, 有些想法用户自己可能都还没有意识到.

### 一个经典的例子 - 尿布和啤酒

一个数据挖掘的经典案例: 一个超市人员发现很多人会同时购买啤酒和尿布, 后来他们认为这是因为很多妇女要在家照顾孩子, 就让自己的丈夫去买尿布, 而丈夫买尿布时还不忘买一下自己喜欢的啤酒, 于是二者产生了联系. 然后超市将这两个商品摆在临近的货架上, 发现销售量增长了.

从中可以看到用户的行为数据中蕴含了很多不是那么显而易见的规律, 而我么的个性化推荐算法的任务就是通过计算机去发现这些规律, 从而为产品的设计提供指导, 提升用户体验.

## 协同过滤

协同过滤算法就是指用户可以齐心协力, 通过不断与网站互动, 使自己的推荐列表能够不断过滤掉不感兴趣的物品, 变得越来越个性化, 这也和亚马逊的为每个用户打造一个属于自己的商店的思想不谋而合.

仅基于用户行为数据设计的推荐算法称为协同过滤算法. 在学术界对这方面有深入的研究, 提出来多种方法, 比如基于邻域的算法, 隐语义模型, 基于图的随机游走算法等. 本文仅介绍两种基于邻域的算法.

- 基于用户的协同过滤算法
- 基于物品的协同过滤算法

## 收集用户的行为

有多种方式收集用户的行为

- 打日志
- 收集用户都商品的喜好程度
- 记录用户所有访问记录等

在设计算法前, 需要对收集到的数据进行分析.

## 基于用户的协同过滤算法

基于用户的协同过滤算法主要包含如下两个步骤

- 找到和目标用户相似的用户集合
- 找到这个用户集合中用户喜欢的, 且目标用户没有听说过的物品推荐给用户

即先找同类用户, 再找同类用户喜欢的商品

### 用户相似度的计算

该算法的难点在于寻找相似的用户集合, 意味着需要对每一个目标用户意外的用户和目标用户进行相似度计算, 取最高的那一部分, 最常规的方法是使用余弦相似度进行计算. 但这样会造成某些用户与目标用户原本一点关系都没有还需要计算一次的浪费. 

为了解决这个问题, 可以在物品中添加用户id的冗余数据, 通过对所有物品的用户id组件稀疏矩阵, 只针对有联系的用户进行计算.

### 目标用户对某一物品感兴趣程度的计算

就是所有与目标用户相似的用户对该目标物品感兴趣的程度的累加. 即越多相似用户喜欢目标物品, 则用户可能越感兴趣

### 热门商品的处理

算到最后会发现, 所有用户都看过或喜欢热门商品, 但目标用户不一定喜欢该热门商品. 比如所有人都买过新华字典, 但这并不能说明他们兴趣相似, 所以推荐新华字典并不是一个好的选择. 换句话说, 两个用户对冷门物品采取过同样的行为更能说明他们的兴趣相似度. 因此计算时应该去除或将其热门商品的权重.

## 基于物品的协同过滤算法

该算法是目前业界使用最多的算法. 无论是亚马逊, 还是Netflix, Youtube, 其推荐算法的基础都是该算法.

### 基于用户的协同过滤算法的问题

随着用户的增长, 用户相似度矩阵会呈平方增长, 而当今互联网用户量及其庞大, 因此带来了用户相似度计算的浪费.

针对这个问题, 亚马逊提出了基于物品的协同过滤算法. 它主要通过分析用户的行为记录计算物品之间的相似度.

### 基于物品的协同过滤算法

该算法主要分为两步

- 计算物品之间的相似度
- 根据物品相似度和用户的历史行为给用户生成推荐列表

### 物品相似度计算

物品i和物品j的相似度, 可以用: 喜欢i的用户中, 喜欢j的用户所占比例 进行计算. 可以想见. 物品相似度的计算, 就是计算物品被很多用户共同喜欢的程度. 

是根据用户对物品的历史记录进行计算, 即一个用户对应购买过的多个物品. 这一点恰好和基于用户的协同算法想法( 它是一个物品存储购买过它的用户冗余数据 )

### 生成推荐列表

计算出物品相似度, 从高到低排列, 剔除用户购买历史, 即为推荐列表.

### 去除活跃用户的影响

活跃用户会造成任何两个物品都存在相似度, 于是物品相似矩阵编程稠密矩阵, 浪费大量的算力. 一个例子就是如果某个书店在当当购买了所有书籍, 把它当成一个常规用户的话, 显然当当的所有书都有一定的相似度了, 显然这是不对的. 因此计算中需要考虑去除活跃用户的影响.

## 两种领域算法的对比

| 项目     | 基于用户的协同过滤算法                                       | 基于物品的协同过滤算法                                       |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 性能     | 适用于用户较少场合, 用户过多造成计算用户相似度矩阵过大       | 适用于物品数量明显小于用户数的场合, 物品过多会造成物品相似度矩阵过大 |
| 场景     | 时效性较强, 但用户个性化不太明显的场合                       | 长尾物品丰富, 用户个性化需求强烈的领域                       |
| 实时性   | 用户新行为不一定造成推荐结果立即变化                         | 用户新行为一定造成结果立即变化                               |
| 冷启动   | 新用户对很少物品产生行为时, 不能立即进行个性化推荐; 新物品上线后只要有行为就能被推荐给兴趣相似的用户 | 相反, 这里新用户只要有一个行为就可以推荐; 新物品上线后要有足够的访问量才能被推荐出去 |
| 推荐解释 | 难以提供给用户信服的推荐理由                                 | 利用用户的历史行为做推荐解释, 比较令人信服                   |

